# https://docs.cypress.io/guides/continuous-integration/github-actions#Caching-Dependencies-and-Build-Artifacts
name: Build and run Cypress tests

on: [push]

jobs:
  cypress-run:
    runs-on: ubuntu-latest
    # https://github.com/cypress-io/cypress-docker-images/tree/master/browsers
    container: cypress/browsers:node16.5.0-chrome97-ff96
    steps:
      - name: ðŸ›Ž  Checkout code from repository
        uses: actions/checkout@v2

      # Install NPM dependencies, cache them correctly and run all Cypress tests
      - name: ðŸ§ª  Run Cypress E2E tests on Chrome
        uses: cypress-io/github-action@v4
        with:
          browser: chrome
          # Build app
          build: npm run build -- --sourcemap false
          # Run web-server from build dist/ output
          start: npm run preview
          # Wait for web-server before starting tests
          wait-on: 'http://localhost:3001'
          # Custom command to start Cypress tests
          command: npm run test:e2e:ci
          # Records the run for Cypress Dashboard
          record: true
          # Custom Cypress config
          # https://docs.cypress.io/guides/references/configuration
          config: "video=false,screenshotOnRunFailure=false"
        env:
          # Pass GitHub token generated automatically by the action itself
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # Pass Cypress Dashboard record key generated automatically by the action itself
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
